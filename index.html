<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Farverig – Spray Painter (clean fade)</title>
    <!-- Load p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
    <!-- Your other head content and CSS links -->
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ensure the canvas covers the viewport behind other layers */
        #canvas-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>
<body>
    <!-- Canvas container for spray-paint effect -->
    <div id="canvas-container"></div>

    <!-- Your page content goes here -->
    <!-- ...existing code... -->

    <!-- Spray Painter Script -->
    <script>
      // Farverig – spray‑paint brush
      // • Tegner konstant mens musen bevæger sig.
      // • Pixler bevarer fuld farve i ~3 s → derefter lineær fade til 0 på ca. 5 s.
      // • Lavere brightness + lavere density for at undgå hvidt/gråt opslam.

      let layer;
      let hueVal = 0;

      const holdFrames = 180;   // 3 sek @ 60 FPS før fade starter
      const fadeAlpha  = 0.01;  // 1% alfa pr. frame under fade (≈5 s)

      let frameCounter = 0;

      function setup(){
        const c = createCanvas(windowWidth, windowHeight);
        c.parent('canvas-container');
        pixelDensity(1);
        frameRate(60);
        noCursor();
        colorMode(HSB,360,100,100,100);

        layer = createGraphics(windowWidth, windowHeight);
        layer.pixelDensity(1);
        layer.colorMode(HSB,360,100,100,100);
        layer.noFill();
        layer.strokeWeight(1);
      }

      function draw(){
        frameCounter++;

        if(frameCounter > holdFrames) fadeLayer();
        if(mouseInCanvas()) sprayPaint();

        background(0);
        image(layer,0,0,width,height);
      }

      // ---------- fade ----------
      function fadeLayer(){
        layer.push();
        layer.drawingContext.globalCompositeOperation = 'destination-out';
        layer.drawingContext.globalAlpha = fadeAlpha;
        layer.rect(0, 0, layer.width, layer.height);
        layer.pop();
      }

      // ---------- spray paint ----------
      function sprayPaint(){
        const speed = abs(mouseX - pmouseX) + abs(mouseY - pmouseY);
        const baseR = 5;
        const density = 40; // færre prikker ⇒ mindre overlap ⇒ mindre gråt
        const r = baseR + speed;
        const rSq = r * r;
        const steps = 6;

        hueVal = (hueVal + 0.5) % 360;
        layer.stroke(hueVal, 65, 80, 100); // brightness 80 (ikke 100)

        for(let i = 0; i < steps; i++){
          const lx = lerp(mouseX, pmouseX, i / steps);
          const ly = lerp(mouseY, pmouseY, i / steps);
          for(let j = 0; j < density; j++){
            const dx = random(-r, r);
            const dy = random(-1, 1) * sqrt(max(rSq - dx * dx, 0));
            layer.point(lx + dx, ly + dy);
          }
        }
      }

      function mouseInCanvas(){
        return mouseX >= 0 && mouseX < width && mouseY >= 0 && mouseY < height;
      }

      function windowResized(){
        resizeCanvas(windowWidth, windowHeight);
        // Create a new graphics buffer at the new size and copy over the old content
        const g = createGraphics(windowWidth, windowHeight);
        g.pixelDensity(1);
        g.colorMode(HSB,360,100,100,100);
        g.image(layer, 0, 0, windowWidth, windowHeight);
        layer = g;
      }
    </script>
</body>
</html>